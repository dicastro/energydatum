<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <title>Energy Datum</title>

    <link rel="icon" href="/energydatum/assets/img/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/energydatum/assets/jqueryui/1.13.1/css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="/energydatum/assets/fomanticui/2.8.8/css/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="/energydatum/assets/datatables/1.11.5/css/dataTables.semanticui.min.css">
    <link rel="stylesheet" type="text/css" href="/energydatum/assets/css/style.css">
</head>
<body>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/plotly/2.12.1/js/plotly.min.js"></script>
<script type="text/javascript">
    window.PlotlyConfig = {MathJaxConfig: 'local'};
</script>

<div class="ui borderless main menu">
    <div class="ui text container">
        <div class="header item">
            <img class="logo" src="/energydatum/assets/img/logo_40x40.png">
            Energy Datum
        </div>
        <div class="ui floating dropdown button item">
            <div class="text">Consumo</div>
            <i class="dropdown icon"></i>
            <div class="menu">
                <a id="consumption_y_menu_item" class=" item" href="/energydatum/consumption/consumption_y.html">Anual</a>
                <a id="consumption_moy_menu_item" class=" item" href="/energydatum/consumption/consumption_moy.html">Mensual</a>
                <a id="consumption_dow_menu_item" class=" item" href="/energydatum/consumption/consumption_dow.html">Día semana</a>
                <a id="consumption_hod_menu_item" class=" item" href="/energydatum/consumption/consumption_hod.html">Horario</a>
                <a id="period_m_menu_item" class=" item" href="/energydatum/consumption/period_m.html">Periodo</a>
                <a id="consumption_dom_menu_item" class=" item" href="/energydatum/consumption/consumption_dom.html">Diario</a>
            </div>
        </div>
        <a id="cost_menu_item" class=" item" href="/energydatum/cost.html">Coste</a>
        <div class="ui floating dropdown button item">
            <div class="text">Datos</div>
            <i class="dropdown icon"></i>
            <div class="menu">
                <a id="price_pvpc_menu_item" class=" item" href="/energydatum/esios/esios_price_20td.html">Precios PVPC</a>
                <div class="divider"></div>
                <a id="bank_days_menu_item" class=" item" href="/energydatum/bank_days.html">Festivos</a>
                <div class="divider"></div>
                <a id="esios_indicators_menu_item" class=" item" href="/energydatum/esios/esios_indicators.html">Indicadores E-SIOS</a>
                <div class="divider"></div>
                <a id="weather_menu_item" class=" item" href="/energydatum/weather.html">Clima</a>
            </div>
        </div>
        <div class="ui floating dropdown button item">
            <div class="text">Autoconsumo</div>
            <i class="dropdown icon"></i>
            <div class="menu">
                <a class="disabled item" href="#">proximamente ...</a>
            </div>
        </div>
        <a id="configuration_menu_item" class="item right active" href="/energydatum/configuration.html">
            <i class="cogs icon"></i>
        </a>
    </div>
</div>

<div class="ui container">
    
<h1>Configuración</h1>

<p>En esta sección se pueden dar de alta las ofertas recibidas por distintas compañias que se utilizarán en el apartado de costes</p>

<div class="ui main text container">
    <div class="ui icon floating yellow centered message">
        <div class="header">
            ¡Atención!
        </div>
        <div class="content">
            <p>Ningún dato introducido será enviado a ningún servidor, ni compartido con ninguna empresa. Los datos introducidos únicamente serán guardados en el navegador. Si se accede a la web desde otro navedador, los datos no estarán disponibles.</p>
        </div>
    </div>
</div>

<h3 class="ui header">
    <i id="rate_20td_info" class="link info circle icon" data-modal-id="rate_20td_info_modal"></i>
    <div class="content">
        Tarifa 2.0TD
    </div>
</h3>

<div id="rate_20td_info_modal" class="ui modal" data-trigger-button="rate_20td_info">
    <h2 class="ui header">Tarifa 2.0TD</h2>
    <div class="content">
        <table class="ui celled table rate">
            <thead>
                <tr>
                    <th>&nbsp;</th>
                    
                    <th class="hour">0</th>
                    
                    <th class="hour">1</th>
                    
                    <th class="hour">2</th>
                    
                    <th class="hour">3</th>
                    
                    <th class="hour">4</th>
                    
                    <th class="hour">5</th>
                    
                    <th class="hour">6</th>
                    
                    <th class="hour">7</th>
                    
                    <th class="hour">8</th>
                    
                    <th class="hour">9</th>
                    
                    <th class="hour">10</th>
                    
                    <th class="hour">11</th>
                    
                    <th class="hour">12</th>
                    
                    <th class="hour">13</th>
                    
                    <th class="hour">14</th>
                    
                    <th class="hour">15</th>
                    
                    <th class="hour">16</th>
                    
                    <th class="hour">17</th>
                    
                    <th class="hour">18</th>
                    
                    <th class="hour">19</th>
                    
                    <th class="hour">20</th>
                    
                    <th class="hour">21</th>
                    
                    <th class="hour">22</th>
                    
                    <th class="hour">23</th>
                    
                </tr>
            </thead>
            <tbody>
                
                <tr>
                    <td>L-V</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P2">&nbsp;</td>
                    
                    <td class="P2">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P2">&nbsp;</td>
                    
                    <td class="P2">&nbsp;</td>
                    
                    <td class="P2">&nbsp;</td>
                    
                    <td class="P2">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P2">&nbsp;</td>
                    
                    <td class="P2">&nbsp;</td>
                    
                </tr>
                
                <tr>
                    <td>S-D + F</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                </tr>
                
            </tbody>
        </table>

        <table class="ui celled table rate">
            <thead>
                <tr>
                    
                    <th>P1</th>
                    
                    <th>P2</th>
                    
                    <th>P3</th>
                    
                </tr>
            </thead>
            <tbody>
                <tr>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P2">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                </tr>
            </tbody>
        </table>
    </div>
    <div class="actions">
        <div class="ui ok button">
            <i class="remove icon"></i>
            Cerrar
        </div>
    </div>
</div>

<div id="offers_rate_20td" class="ui form">
    <p class="nocontent">Sin ofertas</p>
</div>
<div class="ui blue button offer-add" data-rate-type="20td">
    <i class="plus icon"></i>Añadir
</div>

<h3 class="ui header">
    <i id="rate_wk_info" class="link info circle icon" data-modal-id="rate_wk_info_modal"></i>
    <div class="content">
        Tarifa Fin de semana
    </div>
</h3>

<div id="rate_wk_info_modal" class="ui modal" data-trigger-button="rate_wk_info">
    <h2 class="ui header">Tarifa fin de semana</h2>
    <div class="content">
        <table class="ui celled table rate">
            <thead>
                <tr>
                    <th>&nbsp;</th>
                    
                    <th class="hour">0</th>
                    
                    <th class="hour">1</th>
                    
                    <th class="hour">2</th>
                    
                    <th class="hour">3</th>
                    
                    <th class="hour">4</th>
                    
                    <th class="hour">5</th>
                    
                    <th class="hour">6</th>
                    
                    <th class="hour">7</th>
                    
                    <th class="hour">8</th>
                    
                    <th class="hour">9</th>
                    
                    <th class="hour">10</th>
                    
                    <th class="hour">11</th>
                    
                    <th class="hour">12</th>
                    
                    <th class="hour">13</th>
                    
                    <th class="hour">14</th>
                    
                    <th class="hour">15</th>
                    
                    <th class="hour">16</th>
                    
                    <th class="hour">17</th>
                    
                    <th class="hour">18</th>
                    
                    <th class="hour">19</th>
                    
                    <th class="hour">20</th>
                    
                    <th class="hour">21</th>
                    
                    <th class="hour">22</th>
                    
                    <th class="hour">23</th>
                    
                </tr>
            </thead>
            <tbody>
                
                <tr>
                    <td>L-V</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                </tr>
                
                <tr>
                    <td>S-D + F</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                </tr>
                
            </tbody>
        </table>

        <table class="ui celled table rate">
            <thead>
                <tr>
                    
                    <th>P1</th>
                    
                    <th>P3</th>
                    
                </tr>
            </thead>
            <tbody>
                <tr>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P3">&nbsp;</td>
                    
                </tr>
            </tbody>
        </table>
    </div>
    <div class="actions">
        <div class="ui ok button">
            <i class="remove icon"></i>
            Cerrar
        </div>
    </div>
</div>

<div id="offers_rate_wk" class="ui form">
    <p class="nocontent">Sin ofertas</p>
</div>
<div class="ui blue button offer-add" data-rate-type="wk">
    <i class="plus icon"></i>Añadir
</div>

<h3 class="ui header">
    <i id="rate_fix_info" class="link info circle icon" data-modal-id="rate_fix_info_modal"></i>
    <div class="content">
        Tarifa Precio fijo
    </div>
</h3>

<div id="rate_fix_info_modal" class="ui modal" data-trigger-button="rate_fix_info">
    <h2 class="ui header">Tarifa precio fijo</h2>
    <div class="content">
        <table class="ui celled table rate">
            <thead>
                <tr>
                    <th>&nbsp;</th>
                    
                    <th class="hour">0</th>
                    
                    <th class="hour">1</th>
                    
                    <th class="hour">2</th>
                    
                    <th class="hour">3</th>
                    
                    <th class="hour">4</th>
                    
                    <th class="hour">5</th>
                    
                    <th class="hour">6</th>
                    
                    <th class="hour">7</th>
                    
                    <th class="hour">8</th>
                    
                    <th class="hour">9</th>
                    
                    <th class="hour">10</th>
                    
                    <th class="hour">11</th>
                    
                    <th class="hour">12</th>
                    
                    <th class="hour">13</th>
                    
                    <th class="hour">14</th>
                    
                    <th class="hour">15</th>
                    
                    <th class="hour">16</th>
                    
                    <th class="hour">17</th>
                    
                    <th class="hour">18</th>
                    
                    <th class="hour">19</th>
                    
                    <th class="hour">20</th>
                    
                    <th class="hour">21</th>
                    
                    <th class="hour">22</th>
                    
                    <th class="hour">23</th>
                    
                </tr>
            </thead>
            <tbody>
                
                <tr>
                    <td>L-V</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                </tr>
                
                <tr>
                    <td>S-D + F</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                    <td class="P1">&nbsp;</td>
                    
                </tr>
                
            </tbody>
        </table>

        <table class="ui celled table rate">
            <thead>
                <tr>
                    
                    <th>P1</th>
                    
                </tr>
            </thead>
            <tbody>
                <tr>
                    
                    <td class="P1">&nbsp;</td>
                    
                </tr>
            </tbody>
        </table>
    </div>
    <div class="actions">
        <div class="ui ok button">
            <i class="remove icon"></i>
            Cerrar
        </div>
    </div>
</div>

<div id="offers_rate_fix" class="ui form">
    <p class="nocontent">Sin ofertas</p>
</div>
<div class="ui blue button offer-add" data-rate-type="fix">
    <i class="plus icon"></i>Añadir
</div>

<div class="ui divider"></div>

<form class="ui form">
    <input type="file" id="import-file" accept="*.json" style="display:none">

    <button id="import-button" class="ui right floated labeled icon yellow button" type="button">
        <i class="upload icon"></i>
        Importar
    </button>
    <button id="export-button" class="ui right floated labeled icon green button"  type="button" data-filename="configuration.json">
        <i class="download icon"></i>
        Exportar
    </button>
</form>

</div>

<div class="ui inverted vertical footer segment">
    <div class="ui center aligned container">
        <div class="ui stackable inverted divided grid">
            <div class="three wide column">
                <h4 class="ui inverted header">Consumo</h4>
                <div class="ui inverted link list">
                    <a class="item" href="/energydatum/consumption/consumption_y.html">Anual</a>
                    <a class="item" href="/energydatum/consumption/consumption_moy.html">Mensual</a>
                    <a class="item" href="/energydatum/consumption/consumption_dow.html">Día semana</a>
                    <a class="item" href="/energydatum/consumption/consumption_hod.html">Horario</a>
                    <a class="item" href="/energydatum/consumption/period_m.html">Periodo</a>
                    <a class="item" href="/energydatum/consumption/consumption_dom.html">Diario</a>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header">Datos</h4>
                <div class="ui inverted link list">
                    <a class="item" href="/energydatum/esios/esios_price_20td.html">Precios PVPC</a>
                    <a class="item" href="/energydatum/bank_days.html">Festivos</a>
                    <a class="item" href="/energydatum/esios/esios_indicators.html">Indicadores E-SIOS</a>
                    <a class="item" href="/energydatum/weather.html">Clima</a>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header">Autoconsumo</h4>
                <div class="ui inverted link list">
                    <a href="#" class="disabled item">Próximamente ...</a>
                </div>
            </div>
            <div class="seven wide column">
                <h4 class="ui inverted header">¿Quieres un sitio como este?</h4>
                <div class="ui left aligned container">
                    <p>Es muy fácil, únicamente tienes que seguir estos sencillos pasos:</p>
                    <ol>
                        <li>Haz un fork de <a href="https://github.com/dicastro/energydatum" target="_blank">Energy Datum</a></li>
                        <li>Clona tu repo</li>
                        <li>Añade las lecturas de tu contador en formato <i>csv</i></li>
                        <li>Ejecuta el script <code>main.py</code></li>
                        <li>Haz push de los cambios</li>
                    </ol>
                </div>
            </div>
        </div>
        <div class="ui inverted section divider"></div>
        <img src="/energydatum/assets/img/logo_40x40.png" class="ui centered mini image">
        <div class="ui horizontal inverted small divided link list">
            <a class="item" href="https://diegocastroviadero.com/#contact" target="_blank">Contáctame</a>
            <p class="item">v1.0.0-alpha1</p>
            <p class="item">Generado el 27/05/2022 con datos entre 02/06/2020 y 30/04/2022</p>
        </div>
    </div>
</div>

<script type="text/javascript" charset="utf8" src="/energydatum/assets/jquery/3.6.0/js/jquery.min.js"></script>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/jqueryui/1.13.1/js/jquery-ui.min.js"></script>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/datatables/1.11.5/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/datatables/1.11.5/js/dataTables.semanticui.min.js"></script>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/fomanticui/2.8.8/js/semantic.min.js"></script>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/dataframejs/1.4.3/js/dataframe.min.js"></script>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/js/menu.js"></script>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/js/main.js"></script>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/js/table.js"></script>
<script type="text/javascript" charset="utf8" src="/energydatum/assets/js/offer-db.js"></script>

<script type="text/javascript" charset="utf8">
    function getTimestamp() {
        let date = new Date();

        ye = date.getYear();
        mo = date.getMonth() + 1;
        da = date.getDate();
        ho = date.getHours();
        mi = date.getMinutes();
        se = date.getSeconds();

        return `${ye}${mo.toString().padStart(2, '0')}${da.toString().padStart(2, '0')}${ho.toString().padStart(2, '0')}${mi.toString().padStart(2, '0')}${se.toString().padStart(2, '0')}`
    }

    function insertNewRow(rateType) {
        $.get(`/energydatum/assets/html/rate_${rateType}_add_row_template.html?ts=${getTimestamp()}`).done(data => {
            $data = $(data)

            $data.find('.calendar-comp').calendar({
                type: 'date',
                firstDayOfWeek: 1,
                maxDate: new Date(),
                text: {
                    days: ['D', 'L', 'M', 'X', 'J', 'V', 'S'],
                    months: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                    monthsShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                    today: 'Hoy',
                    now: 'Ahora',
                    am: 'AM',
                    pm: 'PM'
                },
                formatter: {
                    date: function (date, settings) {
                        if (!date) return '';
                        var day = date.getDate();
                        var month = date.getMonth() + 1;
                        var year = date.getFullYear();

                        return day.toString().padStart(2, '0') + '/' + month.toString().padStart(2, '0') + '/' + year;
                    }
                }
            });

            $data.find('.popup-comp').popup();

            $(`#offers_rate_${rateType} .nocontent`).remove();
            $(`#offers_rate_${rateType}`).append($data);
        });
    }

    function addRow(offer) {
        $.get(`/energydatum/assets/html/rate_${offer.rateType}_view_row_template.html?ts=${getTimestamp()}`).done(data => {
            $data = $(data)
            $data.attr('id', offer.id);
            $data.find('input[name="company"]').val(offer.company);
            $data.find('input[name="date"]').val(offer.date);

            if (offerdb.consumptionOfferIsCurrent(offer.id)) {
                $data.find('input[name="current"]').attr('checked', 'checked');
            }

            offer.periods.forEach((period, i) => {
                $periodInput = $data.find(`input[name=${period[0]}]`);
                $periodInput.val(period[1]);

                if (offer.dto) {
                    $periodLabel = $periodInput.siblings('label');

                    $periodLabel.append($('<i>', { 'class': 'info circle icon popup-comp', 'data-title': 'Precio original', 'data-content': `${offer.rawPeriods[i][1]} € (Sin dto del ${offer.dto} %)` }));
                }
            });

            $data.find('.popup-comp').popup();

            $data.find('.checkbox-comp').checkbox({
                uncheckable: true,
                onChecked: function(handler) {
                    offerdb.setConsumptionOfferAsCurrent($(this).parents('.fields').attr('id'));
                },
                onUnchecked: function(handler) {
                    offerdb.unsetConsumptionOfferAsCurrent();
                }
            });

            $(`#offers_rate_${offer.rateType} .nocontent`).remove();
            $(`#offers_rate_${offer.rateType}`).append($data);
        });
    }

    function refreshNoContent(rateType) {
        offerCount = $(`#offers_rate_${rateType} .fields`).length;

        if (offerCount === 0) {
            $(`#offers_rate_${rateType}`).append($('<p>', {'class': 'nocontent', 'text': 'Sin ofertas'}));
        }
    }

    function refreshOffers() {
        $('div[id*="offers_rate_"]').empty().append($('<p>', {'class': 'nocontent', 'text': 'Sin ofertas'}));

        offers = offerdb.getAllConsumptionOffers();

        offers.forEach(offer => {
            addRow(offer);
        });
    }

    $(document).ready(function() {
        refreshOffers();

        $('.offer-add').click(handler => {
            rateType = $(handler.currentTarget).data('rate-type');

            insertNewRow(rateType);
        });

        $(document).on('click', '.offer-save', handler => {
            $element = $(handler.currentTarget);
            $fields = $element.closest('.fields');

            company = $fields.find('input[name="company"]').val();
            rateType = $element.data('rate-type');
            date = $fields.find('input[name="date"]').val();
            periods = [];

            $fields.find('input.period').each((i, elem) => {
                $elem = $(elem)
                periods.push([$elem.attr('name'), $elem.val()]);
            });

            dto = $fields.find('input[name="dto"]').val() || 0;

            offer = offerdb.saveConsumptionOffer(company, date, rateType, periods, dto);

            $fields.remove();
            addRow(offer);
        });

        $(document).on('click', '.offer-delete', handler => {
            $element = $(handler.currentTarget);
            rateType = $element.data('rate-type');
            $fields = $element.closest('.fields');

            offerdb.deleteConsumptionOffer($fields.attr('id'));

            $fields.remove();
            refreshNoContent(rateType);
        });

        $(document).on('click', '.offer-cancel', handler => {
            $element = $(handler.currentTarget);
            rateType = $element.data('rate-type');
            $fields = $element.closest('.fields');

            $fields.remove();
            refreshNoContent(rateType);
        });

        $('button#import-button').click(handler => {
            handler.preventDefault();

            if ('FileReader' in window) {
                $('input#import-file').click();
            } else {
                alert('Your browser does not support the HTML5 FileReader.');
            }
        });

        $('input#import-file').change(event => {
            var fileToLoad = event.target.files[0];

            if (fileToLoad) {
                var fileReader = new FileReader();

                fileReader.onload = function(fileLoadedEvent) {
                    var textFromFileLoaded = fileLoadedEvent.target.result;

                    offerdb.load(JSON.parse(textFromFileLoaded));

                    refreshOffers();
                };

                fileReader.readAsText(fileToLoad, 'UTF-8');
            }
        });

        $('button#export-button').click(handler => {
            handler.preventDefault();
            $element = $(handler.currentTarget);
            let fileName = $element.data('filename');

            if ('Blob' in window) {
                var blob = new Blob([JSON.stringify(offerdb.dump())], {type: 'application/json'});

                if ('msSaveOrOpenBlob' in navigator) {
                    navigator.msSaveOrOpenBlob(blob, fileName);
                } else {
                    var downloadLinkElement = document.createElement('a');
                    downloadLinkElement.download = fileName;
                    downloadLinkElement.innerHTML = 'Download File';

                    if ('webkitURL' in window) {
                        downloadLinkElement.href = window.webkitURL.createObjectURL(blob);
                    } else {
                        downloadLinkElement.href = window.URL.createObjectURL(blob);
                    }

                    downloadLinkElement.onclick = event => {
                        document.body.removeChild(event.target);
                    };

                    downloadLinkElement.style.display = 'none';
                    document.body.appendChild(downloadLinkElement);

                    downloadLinkElement.click();
                }
            } else {
                alert('Your browser does not support the HTML5 Blob.');
            }
        });
    });
</script>

</body>
</html>